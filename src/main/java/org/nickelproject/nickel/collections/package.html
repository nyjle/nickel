This is alpha code, there are lots of likely performance issues here.